---
title: "Regression Attempts"
author: "Jordan Gropper"
date: '2022-08-09'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
library(fixest)
library(ggplot2)
library(tidyverse)
library(vtable)
library(Ecdat)
library(ggstance)
library(multcomp)
library(NHANES)
library(corrplot)
library(patchwork)
library(haven)
library(marginaleffects)
```


```{r}
clean_df<- read_csv('../RawData/final_clean.csv')
```





## 1 How has COVID affected the health of the retail industry, as measured by employment?
-Andrew:
```{r}


```


## 2 How has retail fared relative to other industries?
-Jordan:

```{r}
ques2 <- clean_df %>% dplyr::select(YEAR, MONTH, CPSID, WTFINL, AGE, SEX, RACE, CLASSWKR, WHYUNEMP, WKSTAT, INDNAME, covid1_dummy, covid2_dummy, covid3_dummy, REGION)

#Should I control for region and for covid dummies?

ques2$employed_full <- ifelse(ques2$WKSTAT %in% c("Full-time hours (35+), usually full-time", "Full-time hours (35+), usually part-time for economic reasons", "Full-time hours (35+), usually part-time for non-economic reasons"), 1, 0)


ques2$job_loser <- ifelse(ques2$WHYUNEMP %in% c("Job loser - on layoff", "Other job loser"), 1, 0)

ques2$retail_or_not <- ifelse(ques2$INDNAME %in% c("Retail Trade"), 1, 0)

```



This first regression looks at how full time employment has faired over the span of time for the covid waves, and has controls for the different waves of covid, as well as region and implements the weights argument. 
```{r}


#mod1
ques2m1 <- feols(employed_full ~ INDNAME + YEAR + MONTH + REGION + covid1_dummy + covid2_dummy + covid3_dummy, data= ques2, 
                 weights = ques2$WTFINL)
etable(ques2m1) 


resid_1 <- resid(ques2m1)
plot(fitted(ques2m1), resid_1)


```


## WALD tests Question 2
```{r}
wald(ques2m1, c("YEAR", "MONTH")) #both are useful

wald(ques2m1, c("REGION")) # All regions are significant

wald(ques2m1, c( "covid1_dummy", "covid2_dummy", "covid3_dummy")) # all are significant and useful

```



Certainly seems like a binary variable logit model would be more appropriate. I want to verify how job loss looks compared to job maintained first before checking that. The variable Job loser helps look at if the respondent was layed off or lost their job in any way over the span of time.
```{r}
#mod2
ques2m2 <- feols(job_loser ~ retail_or_not + INDNAME + YEAR + MONTH | REGION + covid1_dummy + covid2_dummy + covid3_dummy, 
                 data = ques2, weights = ques2$WTFINL, vcov='hetero')
etable(ques2m2)

resid_2 <- resid(ques2m2)
plot(fitted(ques2m2), resid_2)

```

```{r}
wald(ques2m2, c("YEAR", "MONTH")) #both are useful

wald(ques2m2, c("REGION")) # All regions are significant

wald(ques2m2, c("covid1_dummy", "covid2_dummy", "covid3_dummy")) # all are significant and useful

```

There is a very minor difference between loss of job and those that became unemployed, so we observe that in this regression:
```{r}
#mod3
ques2$unemper <- ifelse(ques2$WKSTAT %in% c("Unemployed, seeking part-time work", "Unemployed, seeking full-time work"), 1, 0)

avg_unemper <- mean(ques2$unemper) #looking for what the probability of being generally unemployed is

ques2m3 <- feols(unemper ~ retail_or_not + YEAR + MONTH | REGION + covid1_dummy + covid2_dummy + covid3_dummy, 
                 data = ques2, weights = ques2$WTFINL, vcov='hetero')
etable(ques2m3)

resid_3 <- resid(ques2m3)
plot(fitted(ques2m3), resid_3)

```
```{r}
wald(ques2m3, c("YEAR", "MONTH")) #both are useful

wald(ques2m3, c("REGION")) # All regions are significant

wald(ques2m3, c("covid1_dummy", "covid2_dummy", "covid3_dummy")) # all are significant and useful

```


## Comparing Through Etable
```{r}
etable(ques2m1, ques2m2, ques2m3)
```



### Now a Logit response for question 2, which will more directly answer the question we are looking at: How did retail do as far as loss of jobs over time, compared with other industries
```{r}

ques2logit <- feglm(unemper ~ retail_or_not + YEAR + MONTH | REGION + covid1_dummy + covid2_dummy + covid3_dummy, 
                 data = ques2, family = binomial(link = 'logit')) # iremoved the weights

log_m <- marginaleffects(ques2logit)
summary(log_m)

resid_log <- resid(ques2logit)
plot(fitted(ques2logit), resid_log) # looks the same as above for logit

ques2 <- ques2 %>% mutate(logit_predict = predict(ques2logit, type="response"))
ques2 <- ques2 %>% mutate(logit_index = predict(ques2logit, type="link"))




ques2 %>% ggplot() +
  geom_line(aes(x=logit_index, y=logit_predict))
```

```{r}
ques2 <- ques2 %>% mutate(logit_index = predict(ques2logit, type="link"))

ques2 %>% ggplot() +
  geom_line(aes(x=logit_index, y=logit_predict)) + geom_smooth(aes(x=logit_index, y=unemper))
```
# This shows that the lines are overlapping a good amount, meaning that our predictions are accurate.





## 3 Retail needs to worry about who has money to spend - what has changed about who is working and earning money?##
-Brooke and Sean
```{r}



```












































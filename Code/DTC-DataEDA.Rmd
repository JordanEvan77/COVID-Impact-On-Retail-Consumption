---
title: "Exploratory Data Analysis"
author: "Jordan Gropper"
date: '2022-07-16'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r, include=FALSE}
# I want to turn off the running code for this, so the libraries are just shown
library(fixest)
library(ggplot2)
library(tidyverse)
library(vtable)
library(Ecdat)
library(ggstance)
library(multcomp)
library(NHANES)
library(corrplot)
library(plotly)
```


```{r}

first_data <- read_csv('../RawData/firstdata.csv')
```
## The Questions:

1 How has COVID affected the health of the retail industry, as measured by employment?
2 How has retail fared relative to other industries?
3 Retail needs to worry about who has money to spend - what has changed about who is working and earning money?##

## Key Visuals:

Sean:
```{r}

colnames(first_data)

sean_data <- first_data %>% 
  dplyr::select(REGION, WTFINL, NCHILD, CLASSWKR, COVIDUNAW, FAMINC, IncNumber, DIFFANY, YEAR, SERIAL, MONTH, HWTFINL, CPSID, YEAR, SERIAL, MONTH, HWTFINL, INDNAME)


```

```{r}


ggplot(sean_data, aes(x = IncNumber)) +
  geom_histogram()

#way more high income than lower income included in the data
```

```{r}

ggplot(sean_data %>% count(CLASSWKR), aes(x = CLASSWKR, y = n)) +
  geom_col()

sean_data %>% count(CLASSWKR)

```
















































Andrew:
```{r}


#"STATEFIP" "CPSIDP" "CITIZEN" "WHYUNEMP" "COVIDLOOK" "RACE"  "PERNUM"

```







































































Brooke:
```{r}

#"METAREA" "AGE" "NATIVITY" "WKSTAT" "INDNAME" "EMPSTAT" "MARST"

```






































































Jordan:
```{r}
#"CBSASZ" "SEX" "HISPAN" "EDUC" "monthyear" "SCHLCOLL" "IND"


jordan_data <- first_data %>% 
  dplyr:: select(CBSASZ, SEX, HISPAN, EDUC, monthyear, SCHLCOLL, IND, IncNumber, INDNAME)

jordan_data %>% ggplot(mapping = aes(CBSASZ)) + 
  geom_histogram(stat = 'count',  fill="blue")



#PLOT OVER TIME: EMPSTAT AND FAMINC by IND:
#FAMINC:
top_earners <- jordan_data %>% 
  group_by(INDNAME) %>% 
  summarise(avg_inc = mean(IncNumber, na.rm=TRUE)) %>%  
  arrange(desc(avg_inc)) %>% 
  head(5)


top_earner_data <- jordan_data %>% group_by(INDNAME, monthyear) %>% summarize(avg_inc = mean(IncNumber, na.rm=TRUE)) %>% 
  filter(INDNAME %in% top_earners$INDNAME)

#this will take a long while to actually show up after being visualized
top_earner_data %>% 
  ggplot(mapping = aes(x = monthyear, y = avg_inc, color = as.factor(INDNAME))) + 
  geom_line() + theme(legend.position = "bottom")



```

```{r}
#PLOT OVER TIME: EMPSTAT AND FAMINC by IND:
#FAMINC:
bot_earners <- jordan_data %>% 
  group_by(INDNAME) %>% 
  summarise(avg_inc = mean(IncNumber, na.rm=TRUE)) %>%  
  arrange(avg_inc) %>% 
  head(5)


bot_earner_data <- jordan_data %>% group_by(INDNAME, monthyear) %>% summarize(avg_inc = mean(IncNumber, na.rm=TRUE)) %>% 
  filter(INDNAME %in% bot_earners$INDNAME)

#this will take a long while to actually show up after being visualized
bot_earner_data %>% 
  ggplot(mapping = aes(x = monthyear, y = avg_inc, color = as.factor(INDNAME))) + 
  geom_line() + theme(legend.position = "bottom")



```
THis above plot is very interesting, seems like the most struggling industries!




```{r}

#CBSASZ, SEX, HISPAN, EDUC, monthyear, SCHLCOLL, IND, IncNumber, INDNAME
jordan_data %>% ggplot(mapping = aes(SEX)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(HISPAN)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(EDUC)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(monthyear)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(SCHLCOLL)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(IND)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(IncNumber)) + 
  geom_histogram(stat = 'count',  fill="blue")

jordan_data %>% ggplot(mapping = aes(INDNAME)) + 
  geom_histogram(stat = 'count',  fill="blue")


```
The above all look useful, but I am in favor of dropping IND in favor of just IndName.


```{r}
top_earner_data %>% 
  ggplot(aes(x = factor(monthyear), y = avg_inc)) +
  geom_boxplot() +
  theme_bw()


```

The variation between these two plots is fascinating, it seems that the lowest earning industries perhaps felt less of an impact on the average income!

```{r}
bot_earner_data %>% 
  ggplot(aes(x = factor(monthyear), y = avg_inc)) +
  geom_boxplot() +
  theme_bw()

```

Change of HISPAN, EDUC, SCHLCOLL and CBSASZ over time:
```{r}
hisp_time <- jordan_data %>% group_by(HISPAN) %>% summarise(n1= n(HISPAN))


hisp_time %>% 
  ggplot(mapping = aes(x = monthyear, y = n1, color = as.factor(HISPAN))) + 
  geom_line()

#-----------EDUC:

educ_time <- jordan_data %>% group_by(EDUC) %>% summarise(n2= n(EDUC))


educ_time %>% 
  ggplot(mapping = aes(x = monthyear, y = n2, color = as.factor(EDUC))) + 
  geom_line()

#----------SCHCOLL

sch_time <- jordan_data %>% group_by(SCHLCOLL) %>% summarise(n3= n(SCHLCOLL))


sch_time %>% 
  ggplot(mapping = aes(x = monthyear, y = n3, color = as.factor(SCHLCOLL))) + 
  geom_line()

```



Jordan's Thoughts: CBSASZ, SEX, HISPAN, EDUC, monthyear, SCHLCOLL, IncNumber, INDNAME are all very useful for controls and analysis.
IND should probably just be dropped.




























